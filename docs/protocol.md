# ARCA Protocol Deep-Dive

ARCA operates using three primary data structures: the **Manifest**, the **Configuration**, and the **Lockfile**.

## 1. The Manifest (`arca-manifest.yaml`)

Located at the root of an asset source, this file defines what assets are available and their version history.

```yaml
schema: 1.0
assets:
  sql-expert:
    kind: prompt
    description: "Transforms natural language to SQL queries"
    versions:
      1.0.0:
        path: "prompts/sql.md"
        ref: 05ffdaafccb31569e3f8dd5a277fe83344231c11
      1.1.0:
        path: "prompts/sql.md"
```

## 2. The Configuration (`.arca-assets.yaml`)

Located in the consumer's project, this file declares which assets the project depends on and where they should be projected.

```yaml
schema: 1.0
sources:
  my-org:
    type: git
    url: "https://github.com/my-org/agent-assets"
assets:
  - id: sql-expert
    source: my-org
    version: "^1.0.0"
    projections:
      default: ".github/prompts/sql.md"
      cursor: ".cursor/prompts/sql.md"
```

## 3. The Lockfile (`.arca-assets.lock`)

Generated by ARCA, this ensures that everyone on the project uses the exact same content.

```json
{
  "assets": [
    {
      "id": "sql-expert",
      "version": "1.1.0",
      "source": "my-org",
      "commit": "abc12345...",
      "sha256": "df7a8b9c...",
      "resolvedAt": "2026-02-17T..."
    }
  ]
}
```

## The Resolution Flow

1. **Discovery**: Read `.arca-assets.yaml` and fetch the latest `arca-manifest.yaml` from its source.
2. **Version Matching**: Resolve SemVer constraints to a specific version.
3. **Download**: Fetch the asset content from the source repository at the resolved Git ref/SHA.
4. **Validation**: Normalize to LF, compute SHA-256, and compare against the lockfile (if present).
5. **Caching**: Store validated content in the global `~/.arca-cache`.
6. **Projection**: Create symlinks (or copies) from the cache to the project's projection paths.
